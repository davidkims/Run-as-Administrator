name: Setup SpringBoot and Maven Project

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  setup:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›’ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ§± Create Project Directories and Dummy Files
        run: |
          mkdir -p /opt/project/springboot/{src,logs,temp}
          mkdir -p /opt/project/maven/{src,target,logs}
          mkdir -p .github/workflows
          mkdir -p /opt/disks/springboot /opt/disks/maven

          echo "Spring Boot Server Log" > /opt/project/springboot/logs/server.log
          echo "Maven Project Placeholder" > /opt/project/maven/src/Main.java
          echo "âœ… ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ìƒì„± ì™„ë£Œ"

      - name: ğŸ’½ Reserve Max Disk Space in .github/workflows
        run: |
          echo "ğŸ“¦ ë””ìŠ¤í¬ ì˜ˆì•½ ê³µê°„ í™•ë³´ ì¤‘..."
          if sudo fallocate -l 100G .github/workflows/.reserve_space; then
            echo "âœ… fallocate ì‚¬ìš© ì„±ê³µ"
          else
            echo "âš ï¸ fallocate ì‹¤íŒ¨: dd ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤"
            sudo dd if=/dev/zero of=.github/workflows/.reserve_space bs=1M count=102400 || echo "âŒ dd ì‹¤íŒ¨: ë””ìŠ¤í¬ ìš©ëŸ‰ ë¶€ì¡±ìœ¼ë¡œ ì˜ˆì•½ ê³µê°„ í™•ë³´ ì‹¤íŒ¨"
          fi
          sudo chmod 777 .github/workflows/.reserve_space
          df -h

      - name: â˜• Install Maven
        run: |
          sudo apt-get update
          sudo apt-get install -y maven
          mvn -v

      - name: ğŸ§ª Test Maven Build Directory
        run: |
          cd /opt/project/maven
          mvn archetype:generate -DgroupId=com.example -DartifactId=test-app -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
          echo "âœ… Maven í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ"

      - name: ğŸš€ Simulate Spring Boot Server Setup
        run: |
          echo "ğŸ› ï¸ Spring Boot ì„œë²„ ì„¤ì¹˜ ì¤‘..."
          mkdir -p /opt/project/springboot/server
          touch /opt/project/springboot/server/app.jar
          echo "Simulated Spring Boot JAR" > /opt/project/springboot/server/app.jar
          echo "âœ… Spring Boot ì„œë²„ ì„¤ì¹˜ ë° JAR ìƒì„± ì™„ë£Œ"

      - name: ğŸ§¾ Summary Report
        run: |
          echo "ğŸ“„ ì‹¤í–‰ ì™„ë£Œ ìš”ì•½:"
          echo "- Spring Boot ê²½ë¡œ: /opt/project/springboot"
          echo "- Maven ê²½ë¡œ: /opt/project/maven"
          echo "- ë””ìŠ¤í¬ ìš©ëŸ‰ íŒŒì¼: .github/workflows/.reserve_space"
          echo "- JAR íŒŒì¼: /opt/project/springboot/server/app.jar"
